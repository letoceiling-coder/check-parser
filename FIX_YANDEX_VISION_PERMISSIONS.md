# Исправление прав доступа Yandex Vision API (403 ошибка)

## Проблема:
Yandex Vision API возвращает ошибку 403 "Permission denied" при попытке распознать текст.

## Решение:

### Вариант 1: Использование API ключа вместо IAM токена (рекомендуется)

1. **Создайте сервисный аккаунт в Yandex Cloud:**
   - Перейдите в [Yandex Cloud Console](https://console.cloud.yandex.ru/)
   - Выберите ваш каталог (folder)
   - Перейдите в "Сервисные аккаунты" → "Создать аккаунт"
   - Назовите его, например, "vision-api-service"

2. **Назначьте роль сервисному аккаунту:**
   - Роль: `ai.vision.user` или `editor` (для полного доступа)
   - Область: выбранный каталог (folder)

3. **Создайте API ключ:**
   - Перейдите в созданный сервисный аккаунт
   - Вкладка "Ключи" → "Создать ключ" → "API ключ"
   - Скопируйте созданный ключ

4. **Обновите .env на сервере:**
   ```bash
   cd ~/project.siteaccess.ru/public_html
   
   # Удалите старый IAM токен
   sed -i '/YANDEX_VISION_API_KEY=/d' .env
   
   # Добавьте API ключ
   echo "YANDEX_VISION_API_KEY=<ваш_api_ключ>" >> .env
   
   # Очистите кеш
   php artisan config:clear
   php artisan cache:clear
   ```

### Вариант 2: Настройка прав для IAM токена

Если вы хотите использовать IAM токен (но он действителен только 12 часов):

1. **Создайте сервисный аккаунт** (как в варианте 1)

2. **Назначьте роль:**
   - Роль: `ai.vision.user`
   - Область: каталог (folder)

3. **Получите IAM токен для сервисного аккаунта:**
   ```bash
   yc iam token create --service-account-id <service-account-id>
   ```

4. **Или используйте OAuth токен** (как вы делали ранее), но убедитесь, что ваш аккаунт имеет права на использование Vision API в этом каталоге.

### Проверка:

После настройки отправьте тестовый чек боту. В логах должно появиться:
```
[INFO] Yandex Vision extracted text
```

Вместо:
```
[ERROR] Yandex Vision API: Permission denied (403)
```

## Примечание:

IAM токены действительны только 12 часов. Для production рекомендуется использовать API ключ сервисного аккаунта.
